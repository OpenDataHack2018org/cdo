@BeginModule
@Name      = CMOR
@Title     = Climate Model Output Rewriting to produce CMIP-compliant data
@Section   = CMOR
@Arguments = infile
@Operators = cmor

@BeginDescription

@C The CDO operator @bold{cmor} reads data with the internal IO library CDI
@C and writes the NetCDF result directly with the CMOR library.

The CDO operator @bold{cmor} converts an @file{infile} into a CMIP-compliant format
by using the CMOR library. Each output file contains a single output variable.
The name of the output files are generated by CMOR based on the DRS (Data reference
Syntax) of the project. CMOR checks and applies the information delivered
through the project dependend @var{MIPtable} on the infile. Additional information
which is required for the conversion can be configured via keyvalues as optional parameters.

By specifying a variable selector keyvalue, e.g. @var{cmor_name=tas}, the user can
pre-select a subset of infile variables. If @var{name} or @var{code} is specified, a
corresponding @var{cmor_name} which can also be found in the @var{MIPtable} is also
required to map the @file{infile} variable to the CMOR-variable. For mapping more
variables at the operator call, one can specify a mapping table via keyword @var{mapping_table}.

Global attributes must be collected in info files and can be specified via keyword
@var{info}. All required and optional global attributes as well as information
about table file formats are given in the 'cdo cmor manual'.

If questions remain, do not hesitate to ask and send an email to wachsmannATdkrz.de.

@EndDescription
@EndModule


@BeginOperator_cmor
@Title     = Climate Model Output Rewriting
@Parameter = MIPtable [cmor_name=VarList,[key=value,...]]
@EndOperator


@BeginParameter
@Item = MIPtable
STRING    Name of the MIP table as used by CMOR.
--------------------------------------------------------------------------------------------
@Item = cmor_name           | cn
STRING    Variable selector and specified in the MIP table.
          Comma separated list of CMOR variable names.
          Default is to process all variables.
@Item = name                | n
STRING    Variable selector.
          Name of a selected @file{infile} variable.
@Item = code                | c
INTEGER   Variable selector. 
          Three digits (GRIB) Code of a selected @file{infile} variable.
--------------------------------------------------------------------------------------------
@Item = info                | i
STRING    Preprozessing.
          List of filenames containing global attributes and information.
          Default: CWD/.cdocmorinfo
@Item = grid_info           | gi
STRING    Preprozessing.
          NetCDF file with model grid description.
@Item = mapping_table       | mt
STRING    Preprozessing.
          Fortran Namelist containing variable information for e.g. renaming.
--------------------------------------------------------------------------------------------
@Item = drs                 | d
CHARACTER Output control.
          Do(=y, default) or do not(=n) move output into the project DRS structure.
@Item = drs_root            | dr
STRING    Output control. CMOR output root directory.
          Default: CWD.
@Item = output_mode         | om
CHARACTER Output control.
          Either 'r' for replace (default) or 'a' for append mode.
@Item = last_chunk          | lc
STRING    Output control. Filename of chunk to which shall be appended.  
@Item = maximum_size        | ms
INTEGER   Output control. Limit of output file sie in GigaByte.
--------------------------------------------------------------------------------------------
@Item = required_time_units | rtu
STRING    Temporal description.
          Time axis reference date specified by the experiment.
          Format: 'days since YYYY-day-month hh:mm:ss'.
@Item = cell_methods        | cm
CHARACTER Temporal description.
          Cell_methods of time axis.
          Value is one of 'm' (default)  , 'p', 'c', 'n'.
--------------------------------------------------------------------------------------------
@Item = units               | u
STRING    Variable attrbiute. Units of the variable.
          Must be known by library UDunits.
@Item = variable_comment    | vc
STRING    Variable attrbiute. Variable comment.
@Item = positive            | p
CHARACTER Variable attrbiute.
          Positive flux direction, either 'u' for upward or 'd' for downward.
--------------------------------------------------------------------------------------------
@Item = scalar_z_coordinate | szc
STRING    Scalar z-coordinate (=name_value).
@Item = character_axis      | ca
STRING    CMOR name of a character axis.
          Valid axes are: basin, vegtype or oline. 
@EndParameter


@BeginExample
Process file with CMOR. In this case a grid mapping is used. The file
{\texttt cmor.rc} contains metadata CMOR expects for
\href{http://cmor.llnl.gov/mydoc_cmor3_api/#cmordatasetjson}
{\texttt cmor_dataset_json()}.

@BeginVerbatim
cdo cmor,Tables/CMIP6_day.json,__grid_table=Tables/CMIP6_grids.json,__info=cmor.rc \
CNRM-CERFACS_rllc.nc
@EndVerbatim
@EndExample
